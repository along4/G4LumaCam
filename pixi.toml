[workspace]
name = "G4LumaCam"
version = "0.5.0"
channels = ["conda-forge"]
# This project currently supports only 64-bit Linux; other platforms (e.g. macOS, Windows) are not targeted.
platforms = ["linux-64"]

[dependencies]
python = "3.11.*"
pip = "*"
cmake = "*"
make = "*"
cxx-compiler = "*"
# NOTE: Geant4 is pinned to 10.6.* to preserve validated physics behavior and
# reproducibility of existing simulations. Newer Geant4 releases (10.7.x/11.x)
# may change physics lists or defaults and have not yet been validated for G4LumaCam.
geant4 = "10.6.*"
qt = "5.12.*"
xorg-libx11 = "*"
xorg-libxext = "*"
xorg-libxmu = "*"
xorg-libxrandr = "*"
freeglut = "*"
numpy = "<2"
pandas = "*"
scikit-learn = "*"
lmfit = "*"
matplotlib-base = "3.8.*"
tifffile = "*"
roifile = "*"
tqdm = "*"
pytest = "*"
jupyterlab = "*"
ipykernel = "*"

[pypi-dependencies]
rayoptics = "*"

[activation.env]
# Path to EMPIR executables so the package can find empir_event2image etc.
EMPIR_PATH = "/opt/empir/v1.0.0/bin"

[tasks]
install = "python -m pip install -e ."
test = "pytest"
build-sim = "SYSROOT_FLAG=; if [ -n \"$CONDA_PREFIX\" ] && [ -d \"$CONDA_PREFIX/x86_64-conda-linux-gnu/sysroot\" ]; then SYSROOT_FLAG=-DCMAKE_SYSROOT=$CONDA_PREFIX/x86_64-conda-linux-gnu/sysroot; fi; cmake -S src/G4LumaCam -B build $SYSROOT_FLAG && cmake --build build && mkdir -p src/G4LumaCam/bin && cp build/lumacam src/G4LumaCam/bin/"
clean-sim = "test ! -d build || cmake --build build --target clean"
