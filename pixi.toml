[workspace]
name = "G4LumaCam"
version = "0.5.0"
channels = ["conda-forge"]
# This project currently targets 64-bit Linux.
platforms = ["linux-64"]

[dependencies]
python = "3.11.*"
pip = "*"
cmake = "*"
make = "*"
cxx-compiler = "*"
sysroot_linux-64 = "*"
geant4 = "10.6.*"
qt = "5.12.*"
xorg-libx11 = "*"
xorg-libxext = "*"
xorg-libxmu = "*"
xorg-libxrandr = "*"
freeglut = "*"
numpy = "<2"
pandas = "*"
scikit-learn = "*"
lmfit = "*"
matplotlib-base = "3.8.*"
tifffile = "*"
roifile = "*"
tqdm = "*"
pytest = "*"
jupyterlab = "*"
ipykernel = "*"

[pypi-dependencies]
rayoptics = "*"

[activation.env]
# EMPIR executables and exports
EMPIR_PATH = "/opt/empir/v1.0.0/bin"
EMPIR_EXPORT_PATH = "/opt/empir/v1.0.0/empir_export"
PATH = "${EMPIR_EXPORT_PATH}:${EMPIR_PATH}:${PATH}"

# Simulation executable location for the Python wrapper
LUMACAM_EXECUTABLE = "${CONDA_PREFIX}/bin/lumacam"

# Geant4 data libraries (matching conda-forge Geant4 10.6 datasets)
G4ABLADATA = "${CONDA_PREFIX}/share/Geant4/data/ABLA3.1"
G4ENSDFSTATEDATA = "${CONDA_PREFIX}/share/Geant4/data/ENSDFSTATE2.2"
G4LEDATA = "${CONDA_PREFIX}/share/Geant4/data/EMLOW7.9.1"
G4LEVELGAMMADATA = "${CONDA_PREFIX}/share/Geant4/data/PhotonEvaporation5.5"
G4NEUTRONHPDATA = "${CONDA_PREFIX}/share/Geant4/data/NDL4.6"
G4PARTICLEXSDATA = "${CONDA_PREFIX}/share/Geant4/data/PARTICLEXS2.1"
G4PIIDATA = "${CONDA_PREFIX}/share/Geant4/data/PII1.3"
G4RADIOACTIVEDATA = "${CONDA_PREFIX}/share/Geant4/data/RadioactiveDecay5.4"
G4REALSURFACEDATA = "${CONDA_PREFIX}/share/Geant4/data/RealSurface2.1.1"
G4SAIDXSDATA = "${CONDA_PREFIX}/share/Geant4/data/SAIDDATA2.0"
G4INCLDATA = "${CONDA_PREFIX}/share/Geant4/data/INCL1.0"

[tasks]
install = "python -m pip install -e ."
test = "pytest"
build-sim = "cmake -S src/G4LumaCam -B build -DCMAKE_SYSROOT=$CONDA_PREFIX/x86_64-conda-linux-gnu/sysroot && cmake --build build && install -m 755 build/lumacam $CONDA_PREFIX/bin/lumacam"
clean-sim = "test ! -d build || cmake --build build --target clean"